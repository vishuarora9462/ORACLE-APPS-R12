--PO_APPROVAL HEIRARCHY QUERY TO FIND THE HEIRARCHY AGAINST A USER
SELECT DISTINCT PPS.NAME AS D, PPS.POSITION_STRUCTURE_ID AS R
           FROM APPS.FND_USER FU,
           APPS.PER_ALL_PEOPLE_F PAPF,
           APPS.PER_ALL_ASSIGNMENTS_F PAAF,
           APPS.HR_ALL_ORGANIZATION_UNITS HAOU,
           APPS.ORG_ORGANIZATION_DEFINITIONS OOD,
           APPS.PO_EMPLOYEE_HIERARCHIES_ALL PEHA,
           APPS.PER_POSITION_STRUCTURES PPS,
           APPS.PER_POSITIONS PPOS,
           APPS.PER_POS_STRUCTURE_VERSIONS PPSV,
           APPS.PER_POS_STRUCTURE_ELEMENTS PPSE
          WHERE UPPER (RTRIM (LTRIM (FU.USER_NAME))) = :P_LOGIN_USER
            AND FU.EMPLOYEE_ID = PAPF.PERSON_ID 
            AND PAPF.PERSON_ID = PAAF.PERSON_ID
--            AND TRUNC (SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE 
--            AND TRUNC (SYSDATE) BETWEEN PAAF.EFFECTIVE_START_DATE AND PAAF.EFFECTIVE_END_DATE
            AND PAAF.POSITION_ID = PPOS.POSITION_ID 
           -- AND PPOS.STATUS = ''VALID''
            AND PAAF.LOCATION_ID = HAOU.LOCATION_ID 
            AND HAOU.ORGANIZATION_ID = OOD.OPERATING_UNIT
            AND PPS.BUSINESS_GROUP_ID = PEHA.BUSINESS_GROUP_ID 
            AND PPS.POSITION_STRUCTURE_ID = PEHA.POSITION_STRUCTURE_ID 
         --   AND PEHA.SUPERIOR_LEVEL > 0
            AND PAPF.PERSON_ID = PEHA.EMPLOYEE_ID 
            AND PPOS.POSITION_ID = PEHA.EMPLOYEE_POSITION_ID 
            AND PPS.POSITION_STRUCTURE_ID = PPSV.POSITION_STRUCTURE_ID
            AND PPOS.POSITION_ID = PPSE.SUBORDINATE_POSITION_ID
           -- AND NVL(PPSV.DATE_TO,SYSDATE+1)  >=  SYSDATE 
            AND PPS.BUSINESS_GROUP_ID = PPSV.BUSINESS_GROUP_ID
            AND PPSE.POS_STRUCTURE_VERSION_ID = PPSV.POS_STRUCTURE_VERSION_ID
